Namaste Node
Ep 7 - Diving into the APIs

Mongoose Model and Operators

* A Model in Mongoose is a subclass of the mongoose.Model class and represents a MongoDB collection and its shape defined using a Schema. Each Model provides an interface for CRUD operations as well as advanced features like aggregation, population, and bulk operations.

    Example: Creating and Using a Model
    js
    const mongoose = require('mongoose');
    const Schema = mongoose.Schema;

    const userSchema = new Schema({ name: String });
    const UserModel = mongoose.model('User', userSchema);

    const userDoc = new UserModel({ name: 'Foo' });
    await userDoc.save();

    const userFromDb = await UserModel.findOne({ name: 'Foo' });
    This code shows how to define a schema, create a model, and interact with documents in MongoDB.

=========================================================================================================================================================================

Core Operators & Methods

Document Creation
* create()
    Creates and saves one or more documents to the database.

    Triggers middleware such as save().

    Example:

    js
    await UserModel.create({ name: 'Jean-Luc Picard' });
    insertMany() / insertOne()

* Bulk or single document insertion.

    insertMany is faster but does not run full middleware for each document.

    Example:

    js
    await UserModel.insertMany([{ name: 'Will Riker' }, { name: 'Geordi LaForge' }]);
    await UserModel.insertOne({ name: 'Benjamin Sisko' });


Reading Documents

* find()
    Finds multiple documents matching a filter.

    Example:

    js
    const users = await UserModel.find({ name: /foo/i });
    findOne()

* Finds a single document.

Example:

js
const user = await UserModel.findOne({ name: 'Foo' });
findById()

Finds a document by its _id.

Example:

js
const user = await UserModel.findById('userObjectId');
exists()

Checks if a document matching the filter exists.

Example:

js
const exists = await UserModel.exists({ name: 'Picard' });
distinct()

Gets distinct values for a specified path.

Example:

js
const names = await UserModel.distinct('name');
Updating Documents
updateOne() / updateMany()

Update one or multiple documents matching a filter.

Supports update operators like $set.

Example:

js
await UserModel.updateOne({ name: 'Foo' }, { $set: { name: 'Bar' } });
await UserModel.updateMany({}, { $set: { active: true } });
findOneAndUpdate() / findByIdAndUpdate()

Find and update a document, returning the old or new version.

Example:

js
const user = await UserModel.findOneAndUpdate({ name: 'Foo' }, { name: 'Bar' }, { new: true });
Deleting Documents
deleteOne() / deleteMany()

Delete one or multiple documents matching a filter.

Example:

js
await UserModel.deleteOne({ name: 'Foo' });
await UserModel.deleteMany({ active: false });
findOneAndDelete() / findByIdAndDelete()

Find and remove a single document, returning it.

Example:

js
const user = await UserModel.findOneAndDelete({ name: 'Foo' });
Aggregation and Advanced Operations
aggregate()

Allows running complex queries using aggregation pipelines.

Example:

js
const results = await UserModel.aggregate([
  { $group: { _id: null, maxBalance: { $max: '$balance' }}},
  { $project: { _id: 0, maxBalance: 1 }}
]);
bulkWrite()

Run multiple write operations in one round trip.

Supports insertOne, updateOne, updateMany, deleteOne, deleteMany, and replaceOne.

Example:

js
await UserModel.bulkWrite([
  { insertOne: { document: { name: 'Alice' } } },
  { updateOne: { filter: { name: 'Alice' }, update: { $set: { name: 'Alicia' } } } },
  { deleteOne: { filter: { name: 'Alicia' } } }
]);
Population
populate()

Automatically replaces specified paths in the document with documents from other collections.

Example:

js
const populatedUser = await UserModel.find().populate('department');
Counting Documents
countDocuments()

Provides an exact count of documents matching a filter.

Example:

js
const count = await UserModel.countDocuments({ active: true });
estimatedDocumentCount()

Quickly estimates the document count (does not use a filter).

Example:

js
const estimate = await UserModel.estimatedDocumentCount();
Additional Useful Operators
applyDefaults()

Applies schema defaults to a POJO or doc.

Example:

js
UserModel.applyDefaults(obj);
applyTimestamps()

Applies timestamps (createdAt, updatedAt) to an object.

Example:

js
UserModel.applyTimestamps(obj);
hydrate()

Converts raw data into a Mongoose Document.

Example:

js
const doc = UserModel.hydrate({ _id: 'idString', name: 'Bob' });
syncIndexes(), diffIndexes(), createIndexes(), ensureIndexes()

Related to managing MongoDB indexes on the underlying collection.