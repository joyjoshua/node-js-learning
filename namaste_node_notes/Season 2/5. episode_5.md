Namaste Node
Episode 5 - Middlewares & Error Handlers

Route Handler
1. The Route handler, the req/ res object should send out the response, else the request will be in pending state and the request will exit due to a timeout
2. Multiple route handlers
    a. We can write multiple route handlers
    app.get("/user", (req, res, next) => {
    try {
        console.log('fetching data asynchronously');
        // Example async fetch
        req.data = 'joshua' ;
        next();
        } catch (error) {
            next(error); // forward error to error handler
        }
    }, (req, res, next) => {
        res.send({ message: "User data fetched", data: req.data });
    });
3. We can chain multiple route handlers to the main ge t function.
    1. In the abnove example, there are 2 route handlers for the same route
    2. Let's assume in the first rH, we are send some data, and doing the same in the second rH, the client will recieve only the first rH response as express exits the route function once the rH is completed and ignores any below rH present
    3. In order to move flow to two or more rH, express provides us a next fn. where if I need to jump from rh1 to rh2. I can call the next() to jump
    4. In the above example, in the first rH within the try block, we are calling the next(), then flow will go the second rH and it sends the response back to the client.
    5. We can group various rH in an array, or combination of arrays and rh
    example
    app.get('/route', [rh1, rh2, rh3, rh4]) // Array of rH
    app.get('/route', [rh1, rh2, rh3, rh4], rh5, rH6) // Combination of Array of rH and reguilar rH
    6. Both of the above examples will run exactly the same way of normal chaining strategy, 
4. Error Handling
    1. we can add 'err' as a first parameter in the request handler for error handling
    app.use("/", (err, req, res, next) => {
        if(err) {
            //log your errors
            res.status(500).send("encountered an error);
        }
    });
    2. Using try, catch block
        app.use("/user/data", (req, res) => {
            try {
                //logic for DB connection etc
                throw new Error('error encountered)
            }
            catch {
                if(err) {
                    res.status(500).send("encountered an error);
                }
            }
        })

5. Code backup for  routes

app.use('/admin', authAdmin);
app.get('/admin/fetchUsers', (req, res) => {
    res.send('User List is sent successfully');
});
app.delete('/admin/deleteUser', (req, res) => {
    res.send('user deleted successfully');
});

app.get('/user/fetchUserDetails', userAuth, (req, res) => {
    res.send('User detail fetched successfully');
});

app.post('/user/login', (req, res) => {
    res.send('User logged in successfully');
});

app.get('/admin/replicateError', (req, res) => {
    throw new Error('replicaating error');
});

app.use("/", (err, req, res, next) => {
    if(err) {
        res.status(500).send('encountered error, bro. Handled using err in request handler');
    }
})
